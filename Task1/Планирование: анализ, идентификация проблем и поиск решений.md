# Планирование. Анализ, идентификация проблем и поиск решения

## 1. Анализ

### Архитектурные и продуктовые проблемы

- Все приложения работают на одном инстансе EC2, любая деградация - падение всего приложения (single point of failure)
- То же касается баз данных - один инстанс, один точка отказа
- Расчёты MES отделены от магазина, но не позволяют получить прирост в производительности
  - MES считает стоимость долго (до 30 мин/заказ)
  - Нет параллельного просчёта (блокирует очередь)
- Слабая масштабируемость при росте числа заказов
  - Рост количества заказов не покрывается увеличением/масштабированием приложений
  - API "завалило" компанию, но ресурсов под это не выделено
- Dashboard в MES тормозит
  - Не решено пагинацией и фильтрами - есть проблема медленных (неиндексированных?) запросов или недостатка ресурсов.
- RabbitMQ как интеграционный слой
  - При росте нагрузки может не справляться без резервирования и мониторинга.
- Нет отказоустойчивости ни на одном уровне.
- Низкая наблюдаемость - отсутствует мониторинг, логирование, трейсинг

### Процессные и организационные проблемы

- Слабый уровень автоматизации тестирования
  - QA работает вручную, блокирует релизы багами - задержки растут.
- Длительный time-to-release, куча багов - всё выливается в задержки
- Нет чёткой видимости и контроля над состоянием заказов
  - Потерянные заказы (B2B/B2C) - клиенты не знают, что с их заказом.
- Нет мониторинга, алёртов, логирования по важным метрикам и процессам.
- API появился резко, не был проведён нагрузочный анализ, система не была подготовлена к внезапному росту трафика.

## 2. Инициативы для устранения проблем

### Критичные (высокий приоритет)

- Повысить отказоустойчивость приложений и БД:
  - Минимум - настроить автоскейлинг, добавить дополнительные инстансы и репликации БД. 
- Провести оптимизацию и рефакторинг производительности MES (особенно - расчёта стоимости):
  - Профилирование, кеширование, параллельные очереди, лимиты расчётов
- Реализовать очереди и приоритезацию заказов на расчёт:
  - Асинхронно обрабатывать заказы, уведомлять пользователя о положении заказа в очереди
- Быстро внедрить базовые метрики, мониторинг и алерты:
  - Prometheus/Grafana - контроль SLA/API, время расчёта, задержки и падения сервисов 
- Оптимизация основных проблемных запросов (особенно дашборда MES):
  - Индексирование, денормализация, кэширование дашборда

### Процессные и “быстрые” улучшения (средний приоритет)

- Внедрить базовую автоматизацию тестирования (E2E для основных сценариев)
- Постепенно разделять монолиты на микросервисы (начать - с расчёта стоимости):
  - Выделить расчёт стоимости в отдельный сервис с очередями и скейлингом 
- Запустить нагрузочное тестирование (API, расчет, дашборды):
  - Понять реальные лимиты, выявить узкие места 
- Регулярно проводить ретроспективы по инцидентам и жалобам клиентов:
  - Улучшать бизнес-процессы по результатам анализа

## 4. Целевая архитектура через полгода

- Минимум - устранены single point of failure на каждом уровне (приложения, БД, очередь)
- MES расчёт вынесен в отдельный масштабирующийся микросервис
- На ключевые сценарии настроен мониторинг и алерты
- Запущен CI-пайплайн с автоматическими E2E тестами для основных сценариев
- Внедрены: очереди обработки заказов (с приоритезацией), оптимизированы запросы на дашборде MES
- Вся архитектура описана в технической документации, команда познакомлена с практиками и схемой масштабирования

## Обоснование топ-3 краткосрочных инициатив:

### 1. Оптимизация/параллелизация расчёта стоимости в MES
Почему:
- Узкое горлышко, из-за которого заказы “застревают”
- Ускорит обработку, снизит просрочки по заказам, уменьшит влияние на API и B2B & B2C каналы
- Даст эффект на уровне бизнеса - меньше отмен, меньше негативных отзывов

### 2. Внедрение отказоустойчивости и масштабируемости инфраструктуры
Почему:
- Ежемесячный рост на 100 пользователей будет постоянно приводить к перегрузу, а один инстанс - single point of failure
- Автоскейлинг по нагрузке и репликация БД = минимизация происшествий, улучшение SLA по доступности

### 3. Внедрение мониторинга и алёртов
Почему:
- Сейчас команда реагирует только на жалобы, проактивного контроля нет
- Оперативное обнаружение проблем, накопления очереди, падения интеграции, проблем с производительностью может снизить ущерб и обеспечить быстрые фиксы